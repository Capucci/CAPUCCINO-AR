<!DOCTYPE html>
<html>
<head>
   <script>
const VERSION = "1.9.5"; 
</script>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

<style>
body {
  margin: 0;
  overflow: hidden;
}
</style>

</head>

<body>

<a-scene
  mindar-image="imageTargetSrc: Target01.mind;"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: false"
  embedded
  color-space="sRGB"
  renderer="colorManagement: true, physicallyCorrectLights">

  <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

  <!-- =============================== -->
  <!-- ðŸŽ¯ TARGET 0 - MODELO + MÃšSICA -->
  <!-- =============================== -->
  <a-entity mindar-image-target="targetIndex: 0" id="target-mascote">

    <a-entity
      id="modelo3d"
      gltf-model="Cena 01Teste.glb"
      animation-mixer
      position="0 0 0.3"
      rotation="-90 0 0"
      scale="0.7 0.7 0.7">
    </a-entity>

  </a-entity>


  <!-- =============================== -->
  <!-- ðŸŽ¯ TARGET 1 - VÃDEO COM ÃUDIO -->
  <!-- =============================== -->
  <a-entity mindar-image-target="targetIndex: 1" id="target-video">

    <a-video
      src="#videoSource"
      width="1"
      height="0.6"
      position="0 0 0"
      rotation="0 0 0">
    </a-video>

  </a-entity>


  <!-- ðŸŽµ Ãudio Mascote -->
  <audio id="audioMascote" preload="auto">
    <source src="AudioTrack11.mp3" type="audio/mpeg">
  </audio>

  <!-- ðŸŽ¬ VÃ­deo -->
  <video
    id="videoSource"
    src="Video Antecipe Portugues 1.mp4"
    preload="auto"
    webkit-playsinline
    playsinline
    crossorigin="anonymous">
  </video>

</a-scene>


<script>
document.addEventListener("DOMContentLoaded", function () {

  const targetMascote = document.querySelector('#target-mascote');
  const targetVideo = document.querySelector('#target-video');

  const audioMascote = document.querySelector('#audioMascote');
  const video = document.querySelector('#videoSource');

  let audioTime = 0;
  let videoTime = 0;

  let audioUnlocked = false;
  let videoUnlocked = false;

  /* ============================= */
  /* ðŸ”“ DESBLOQUEIO PARA MOBILE   */
  /* ============================= */

  document.body.addEventListener("click", unlockMedia);
  document.body.addEventListener("touchstart", unlockMedia);

  function unlockMedia() {

    if (!audioUnlocked) {
      audioMascote.play().then(() => {
        audioMascote.pause();
        audioUnlocked = true;
      }).catch(() => {});
    }

    if (!videoUnlocked) {
      video.play().then(() => {
        video.pause();
        videoUnlocked = true;
      }).catch(() => {});
    }
  }

  /* ============================= */
  /* ðŸŽµ TARGET 0 - MASCOTE        */
  /* ============================= */

  targetMascote.addEventListener("targetFound", () => {
    audioMascote.currentTime = audioTime;
    audioMascote.play();
  });

  targetMascote.addEventListener("targetLost", () => {
    audioTime = audioMascote.currentTime;
    audioMascote.pause();
  });

  /* ============================= */
  /* ðŸŽ¬ TARGET 1 - VÃDEO          */
  /* ============================= */

  targetVideo.addEventListener("targetFound", () => {
    video.currentTime = videoTime;
    video.play();
  });

  targetVideo.addEventListener("targetLost", () => {
    videoTime = video.currentTime;
    video.pause();
  });

  /* ============================= */
  /* ðŸ” RESET AUTOMÃTICO AO FINAL */
  /* ============================= */

  audioMascote.addEventListener("ended", () => {
    audioTime = 0;
  });

  video.addEventListener("ended", () => {
    videoTime = 0;
  });

});
</script>

</body>
</html>
