<!DOCTYPE html>
<html>
<head>
   <script>
const VERSION = "1.0.0"; 
</script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

<style>
body { margin:0; overflow:hidden; }
.audio-control-btn {
  position: fixed;
  bottom: 20px;
  left: 20px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  z-index: 9999;
  cursor: pointer;
  border: 2px solid white;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  transition: all 0.3s ease;
  font-size: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: rgba(0, 0, 0, 0.7);
}
.audio-control-btn.playing { background-color: rgba(0, 128, 0, 0.8); }
.audio-control-btn.paused { background-color: rgba(255, 0, 0, 0.8); }
.audio-control-btn:hover { transform: scale(1.1); }
.a-enter-vr {
  position: fixed;
  bottom: 20px !important;
  right: 20px !important;
  left: auto !important;
  top: auto !important;
  transform: none !important;
}
</style>
</head>

<body>

<a-scene
  mindar-image="imageTargetSrc: targets.mind;"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: false">

  <a-camera position="0 0 0" look-controls="enabled: false">
    <a-entity cursor="fuse: false; rayOrigin: mouse"
              raycaster="objects: .clickable"
              geometry="primitive: ring; radiusInner: 0.001; radiusOuter: 0.001"
              material="transparent: true">
    </a-entity>
  </a-camera>

  <!-- ========================================= -->
  <!-- BLOCO DE CENA - TARGET 0                  -->
  <!-- ========================================= -->
  <!-- 
    INSTRUÃ‡Ã•ES:
    1. Copie este bloco para cada target
    2. Mude targetIndex="0" para 1, 2, 3...
    3. Mude id="cena-00" para cena-01, cena-02...
    4. Preencha apenas o que vocÃª quer usar
    5. Deixe em branco o que nÃ£o quiser usar
  -->
  <a-entity mindar-image-target="targetIndex: 0" id="cena-00" class="cena">
    
    <!-- ========== MODELO 3D ========== -->
    <!-- Coloque o nome do arquivo .glb ou deixe vazio -->
    <a-entity
      id="modelo-cena00"
      gltf-model=""        <!-- Ex: "mascote.glb" -->
      animation-mixer="clip: ; loop: repeat;"  <!-- Ex: "fala" -->
      position="0 0 0.3"
      rotation="-90 0 0"
      scale="0.7 0.7 0.7"
      visible="false">     <!-- NÃ£o mexer -->
    </a-entity>
    
    <!-- ========== ÃUDIO ========== -->
    <!-- Coloque o nome do arquivo .mp3 ou deixe vazio -->
    <audio id="audio-cena00" preload="auto" loop style="display: none;">
      <source src="" type="audio/mpeg">  <!-- Ex: "musica.mp3" -->
    </audio>
    
    <!-- ========== VÃDEO ========== -->
    <!-- Coloque o nome do arquivo .mp4 ou deixe vazio -->
    <video id="video-cena00" preload="auto" loop style="display: none;" crossorigin="anonymous">
      <source src="" type="video/mp4">  <!-- Ex: "video.mp4" -->
    </video>
    
    <!-- Tela do vÃ­deo (aparece automaticamente se tiver vÃ­deo) -->
    <a-entity
      id="video-screen-cena00"
      geometry="primitive: plane; width: 1; height: 0.56"
      material="shader: flat; src: #video-cena00; transparent: true;"
      position="0 0 0.3"
      rotation="-90 0 0"
      scale="0.7 0.7 0.7"
      visible="false">     <!-- NÃ£o mexer -->
    </a-entity>

    <!-- ========== BOTÃ•ES ========== -->
    <!-- 
      COMO USAR:
      1. Copie o bloco <a-entity class="clickable botao"> abaixo
      2. Cole quantos botÃµes quiser
      3. Preencha os dados:
         - position: onde o botÃ£o aparece (x y z)
         - data-acao: o que faz (cena, url, whatsapp, email)
         - data-valor: para onde vai (cena-01, https://...)
         - data-cena-origem: de qual cena este botÃ£o veio (cena-00)
         - Cor do material
         - Texto do botÃ£o (value)
    -->
    
    <!-- EXEMPLO DE BOTÃƒO 1 - Vai para outra cena -->
    <a-entity class="clickable botao"
              geometry="primitive: sphere; radius: 0.1"
              material="color: #ff4444; emissive: #440000;"
              position="0.3 0.2 0.4"
              scale="0.7 0.7 0.7"
              data-acao="cena"
              data-valor="cena-01"        <!-- Para qual cena -->
              data-cena-origem="cena-00"   <!-- De onde veio -->
              visible="false">             <!-- NÃ£o mexer -->
      
      <!-- Texto do botÃ£o (mude o texto) -->
      <a-entity text="value: 01; color: white; align: center; width: 2"
                position="0 0.15 0"
                scale="0.3 0.3 0.3">
      </a-entity>
      
      <!-- AnimaÃ§Ã£o de flutuaÃ§Ã£o (opcional) -->
      <a-animation attribute="position"
                   from="0.3 0.2 0.4"
                   to="0.3 0.27 0.4"
                   dur="1000"
                   direction="alternate"
                   repeat="indefinite">
      </a-animation>
    </a-entity>

    <!-- EXEMPLO DE BOTÃƒO 2 - Abre URL -->
    <a-entity class="clickable botao"
              geometry="primitive: sphere; radius: 0.1"
              material="color: #44ff44; emissive: #004400;"
              position="-0.3 0.2 0.4"
              scale="0.7 0.7 0.7"
              data-acao="url"
              data-valor="https://google.com"  <!-- URL -->
              data-cena-origem="cena-00"
              visible="false">
      
      <a-entity text="value: ðŸŒ; color: white; align: center; width: 2"
                position="0 0.15 0"
                scale="0.3 0.3 0.3">
      </a-entity>
    </a-entity>

    <!-- EXEMPLO DE BOTÃƒO 3 - WhatsApp -->
    <a-entity class="clickable botao"
              geometry="primitive: sphere; radius: 0.1"
              material="color: #25D366; emissive: #004400;"
              position="0 0.2 0.4"
              scale="0.7 0.7 0.7"
              data-acao="whatsapp"
              data-valor="https://wa.me/5511999999999"
              data-cena-origem="cena-00"
              visible="false">
      
      <a-entity text="value: ðŸ“±; color: white; align: center; width: 2"
                position="0 0.15 0"
                scale="0.3 0.3 0.3">
      </a-entity>
    </a-entity>

    <!-- EXEMPLO DE BOTÃƒO 4 - Email -->
    <a-entity class="clickable botao"
              geometry="primitive: sphere; radius: 0.1"
              material="color: #ffaa44; emissive: #442200;"
              position="0.6 0.2 0.4"
              scale="0.7 0.7 0.7"
              data-acao="email"
              data-valor="mailto:contato@email.com"
              data-cena-origem="cena-00"
              visible="false">
      
      <a-entity text="value: âœ‰ï¸; color: white; align: center; width: 2"
                position="0 0.15 0"
                scale="0.3 0.3 0.3">
      </a-entity>
    </a-entity>

  </a-entity>
  <!-- ===== FIM DO BLOCO DA CENA 00 ===== -->


  <!-- ========================================= -->
  <!-- BLOCO DE CENA - TARGET 1                  -->
  <!-- ========================================= -->
  <!-- COPIE O BLOCO ACIMA E COLE AQUI -->
  <!-- DEPOIS MUDE targetIndex="1" E id="cena-01" -->
  <a-entity mindar-image-target="targetIndex: 1" id="cena-01" class="cena">
    
    <!-- MODELO 3D -->
    <a-entity
      id="modelo-cena01"
      gltf-model=""        <!-- EX: "milho-chuva.glb" -->
      animation-mixer="clip: ; loop: repeat;"
      position="0 0 0.3"
      rotation="-90 0 0"
      scale="0.7 0.7 0.7"
      visible="false">
    </a-entity>
    
    <!-- ÃUDIO -->
    <audio id="audio-cena01" preload="auto" loop style="display: none;">
      <source src="" type="audio/mpeg">  <!-- EX: "chuva.mp3" -->
    </audio>
    
    <!-- VÃDEO -->
    <video id="video-cena01" preload="auto" loop style="display: none;" crossorigin="anonymous">
      <source src="" type="video/mp4">
    </video>
    
    <!-- Tela do vÃ­deo -->
    <a-entity
      id="video-screen-cena01"
      geometry="primitive: plane; width: 1; height: 0.56"
      material="shader: flat; src: #video-cena01; transparent: true;"
      position="0 0 0.3"
      rotation="-90 0 0"
      scale="0.7 0.7 0.7"
      visible="false">
    </a-entity>

    <!-- BOTÃ•ES - COLOQUE SEUS BOTÃ•ES AQUI -->
    
    <!-- BotÃ£o para voltar Ã  CENA 00 -->
    <a-entity class="clickable botao"
              geometry="primitive: sphere; radius: 0.1"
              material="color: #ffff44; emissive: #444400;"
              position="0.3 0.2 0.4"
              scale="0.7 0.7 0.7"
              data-acao="cena"
              data-valor="cena-00"
              data-cena-origem="cena-01"
              visible="false">
      
      <a-entity text="value: ðŸ”™; color: black; align: center; width: 2"
                position="0 0.15 0"
                scale="0.3 0.3 0.3">
      </a-entity>
    </a-entity>

  </a-entity>

  <!-- ========================================= -->
  <!-- BLOCO DE CENA - TARGET 2                  -->
  <!-- ========================================= -->
  <a-entity mindar-image-target="targetIndex: 2" id="cena-02" class="cena">
    <!-- COPIE O MODELO AQUI E PREENCHA -->
  </a-entity>

  <!-- ========================================= -->
  <!-- BLOCO DE CENA - TARGET 3                  -->
  <!-- ========================================= -->
  <a-entity mindar-image-target="targetIndex: 3" id="cena-03" class="cena">
    <!-- COPIE O MODELO AQUI E PREENCHA -->
  </a-entity>

  <!-- ========================================= -->
  <!-- BLOCO DE CENA - TARGET 4                  -->
  <!-- ========================================= -->
  <a-entity mindar-image-target="targetIndex: 4" id="cena-04" class="cena">
    <!-- COPIE O MODELO AQUI E PREENCHA -->
  </a-entity>

  <!-- ========================================= -->
  <!-- BLOCO DE CENA - TARGET 5                  -->
  <!-- ========================================= -->
  <a-entity mindar-image-target="targetIndex: 5" id="cena-05" class="cena">
    <!-- COPIE O MODELO AQUI E PREENCHA -->
  </a-entity>

</a-scene>

<!-- BotÃ£o de Ã¡udio -->
<button class="audio-control-btn paused" id="audioBtn">ðŸ”‡</button>

<script>
document.addEventListener("DOMContentLoaded", function () {
  
  // ============================================
  // SISTEMA DE GERENCIAMENTO (NÃƒO PRECISA MEXER)
  // ============================================
  
  // Coletar todas as cenas disponÃ­veis
  const cenas = [];
  document.querySelectorAll('.cena').forEach(cena => {
    cenas.push(cena.id);
  });

  // Estado de cada cena
  const estadoCenas = {};
  cenas.forEach(cenaId => {
    estadoCenas[cenaId] = {
      tempoAudio: 0,
      tempoVideo: 0,
      ativa: false
    };
  });

  let cenaAtual = null;
  let mediaUnlocked = false;
  const audioBtn = document.getElementById('audioBtn');

  // ============================================
  // FUNÃ‡ÃƒO PARA ATIVAR UMA CENA
  // ============================================
  window.ativarCena = function(cenaId) {
    console.log('ðŸŽ¬ Ativando:', cenaId);
    
    // Desativar cena atual
    if (cenaAtual && cenaAtual !== cenaId) {
      desativarCena(cenaAtual);
    }
    
    const cenaEl = document.getElementById(cenaId);
    if (!cenaEl) return;
    
    // ATIVAR MODELO 3D
    const modelo = cenaEl.querySelector('[gltf-model]');
    if (modelo && modelo.getAttribute('gltf-model')) {
      modelo.setAttribute('visible', 'true');
      modelo.setAttribute('animation-mixer', 'timeScale', 1);
    }
    
    // ATIVAR VÃDEO
    const video = document.getElementById(`video-${cenaId}`);
    const tela = document.getElementById(`video-screen-${cenaId}`);
    if (video && video.querySelector('source').src && tela) {
      video.currentTime = estadoCenas[cenaId].tempoVideo;
      tela.setAttribute('visible', 'true');
      if (mediaUnlocked) {
        video.play().catch(() => {});
      }
    }
    
    // ATIVAR ÃUDIO
    const audio = document.getElementById(`audio-${cenaId}`);
    if (audio && audio.querySelector('source').src) {
      audio.currentTime = estadoCenas[cenaId].tempoAudio;
      if (mediaUnlocked) {
        audio.play().catch(() => {});
      }
    }
    
    // ATIVAR BOTÃ•ES
    cenaEl.querySelectorAll('.botao').forEach(btn => {
      if (btn.getAttribute('data-acao')) { // SÃ³ mostra se tiver aÃ§Ã£o configurada
        btn.setAttribute('visible', 'true');
      }
    });
    
    estadoCenas[cenaId].ativa = true;
    cenaAtual = cenaId;
    atualizarBotaoAudio();
  };

  // ============================================
  // FUNÃ‡ÃƒO PARA DESATIVAR UMA CENA
  // ============================================
  function desativarCena(cenaId) {
    const cenaEl = document.getElementById(cenaId);
    if (!cenaEl) return;
    
    // SALVAR TEMPO DO ÃUDIO
    const audio = document.getElementById(`audio-${cenaId}`);
    if (audio) {
      estadoCenas[cenaId].tempoAudio = audio.currentTime;
      audio.pause();
    }
    
    // SALVAR TEMPO DO VÃDEO
    const video = document.getElementById(`video-${cenaId}`);
    if (video) {
      estadoCenas[cenaId].tempoVideo = video.currentTime;
      video.pause();
    }
    
    // PAUSAR ANIMAÃ‡ÃƒO
    const modelo = cenaEl.querySelector('[gltf-model]');
    if (modelo) {
      modelo.setAttribute('animation-mixer', 'timeScale', 0);
    }
    
    // ESCONDER TUDO
    cenaEl.querySelectorAll('[visible="true"]').forEach(el => {
      if (el.id !== cenaId) {
        el.setAttribute('visible', 'false');
      }
    });
    
    estadoCenas[cenaId].ativa = false;
  }

  // ============================================
  // DETECTAR TARGETS
  // ============================================
  document.querySelectorAll('.cena').forEach(cena => {
    cena.addEventListener("targetFound", () => {
      ativarCena(cena.id);
    });

    cena.addEventListener("targetLost", () => {
      if (cenaAtual === cena.id) {
        desativarCena(cena.id);
        cenaAtual = null;
        atualizarBotaoAudio();
      }
    });
  });

  // ============================================
  // BOTÃ•ES DE AÃ‡ÃƒO
  // ============================================
  document.querySelectorAll('.botao').forEach(botao => {
    botao.addEventListener('click', function(e) {
      e.stopPropagation();
      
      const acao = this.getAttribute('data-acao');
      const valor = this.getAttribute('data-valor');
      const cenaOrigem = this.getAttribute('data-cena-origem');
      
      console.log(`ðŸ‘† AÃ§Ã£o: ${acao} â†’ ${valor}`);
      
      // Feedback visual
      this.setAttribute('material', 'emissive', '#ffffff');
      setTimeout(() => {
        this.setAttribute('material', 'emissive', this.getAttribute('material').emissive);
      }, 200);
      
      // Processar aÃ§Ã£o
      switch(acao) {
        case 'cena':
          // Salvar estado da cena atual
          if (cenaOrigem) {
            const audio = document.getElementById(`audio-${cenaOrigem}`);
            if (audio) estadoCenas[cenaOrigem].tempoAudio = audio.currentTime;
            const video = document.getElementById(`video-${cenaOrigem}`);
            if (video) estadoCenas[cenaOrigem].tempoVideo = video.currentTime;
          }
          // Ativar nova cena
          ativarCena(valor);
          break;
          
        case 'url':
        case 'whatsapp':
        case 'email':
          window.open(valor, '_blank');
          break;
      }
    });
  });

  // ============================================
  // BOTÃƒO DE ÃUDIO GLOBAL
  // ============================================
  function atualizarBotaoAudio() {
    const tocando = Object.values(estadoCenas).some(e => e.ativa);
    audioBtn.innerHTML = tocando ? 'ðŸ”Š' : 'ðŸ”‡';
    audioBtn.className = `audio-control-btn ${tocando ? 'playing' : 'paused'}`;
  }

  audioBtn.addEventListener('click', function() {
    if (!mediaUnlocked) {
      mediaUnlocked = true;
      document.querySelectorAll('audio, video').forEach(m => {
        m.play().then(() => m.pause()).catch(() => {});
      });
    }
    
    if (cenaAtual) {
      if (estadoCenas[cenaAtual].ativa) {
        desativarCena(cenaAtual);
      } else {
        ativarCena(cenaAtual);
      }
    }
  });

  // Desbloquear mÃ­dia no primeiro clique
  document.body.addEventListener('click', function unlock() {
    if (!mediaUnlocked) {
      mediaUnlocked = true;
      document.querySelectorAll('audio, video').forEach(m => {
        m.play().then(() => m.pause()).catch(() => {});
      });
    }
  }, { once: true });

  console.log('ðŸš€ Sistema de blocos genÃ©ricos pronto!');
  console.log('ðŸ“‹ Cenas disponÃ­veis:', cenas);
});
</script>

</body>
</html>
