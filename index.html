<!DOCTYPE html>
<html>
<head>
   <script>
const VERSION = "1.9.2"; 
// ‚Üë SEMPRE que atualizar v√≠deo ou target, mude esse n√∫mero
</script>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

<style>
  html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }
  
  /* A cena precisa ser transparente para ver a c√¢mera */
  .a-scene, a-scene, .a-canvas, canvas {
    background-color: transparent !important;
  }
  
  /* Remove elementos indesejados */
  .a-loader-title, .rs-base, .mind-ar-overlay {
    display: none !important;
  }
  
  /* Bot√£o VR */
  .a-enter-vr {
    position: fixed;
    bottom: 20px !important;
    right: 20px !important;
    left: auto !important;
    top: auto !important;
    transform: none !important;
    z-index: 999;
  }
</style>

</head>

<body style="margin: 0; padding: 0; overflow: hidden; background-color: black;">

<a-scene
  mindar-image="imageTargetSrc: Target01.mind; autoStart: true;"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: false"
  background="transparent"
  embedded
  style="width: 100%; height: 100%; position: fixed; top: 0; left: 0;">

  <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

  <a-entity mindar-image-target="targetIndex: 0" id="target-principal">

    <!-- V√çDEO CENTRALIZADO - ROTA√á√ÉO CORRIGIDA -->
    <a-video
      id="video-principal"
      src="#meuVideo"
      position="0 0 0.1"
      rotation="0 0 0"
      width="1.5"
      height="0.85"
      material="transparent: false; side: double;">
    </a-video>

  </a-entity>

  <!-- Elemento de v√≠deo HTML5 - com √°udio FOR√áADO -->
  <video id="meuVideo" preload="auto" loop="false" crossorigin="anonymous" style="display: none;" playsinline webkit-playsinline>
    <source src="Video Antecipe Portugues 1.mp4" type="video/mp4">
  </video>

  <script>
document.addEventListener("DOMContentLoaded", function () {

  const target = document.querySelector('#target-principal');
  const videoElement = document.querySelector('#meuVideo');
  
  let videoUnlocked = false;
  let videoPausedTime = 0;
  let isVideoPlaying = false;
  let firstTargetFound = false;

  // FOR√áA o √°udio do v√≠deo
  videoElement.muted = false;  // Garante que n√£o est√° mudo
  videoElement.volume = 1.0;   // Volume m√°ximo

  // Fun√ß√£o para tocar o v√≠deo
  function playVideo() {
    if (!videoUnlocked) {
      // Toca o v√≠deo e tenta desbloquear √°udio
      let playPromise = videoElement.play();
      
      if (playPromise !== undefined) {
        playPromise
          .then(() => {
            videoUnlocked = true;
            isVideoPlaying = true;
            console.log('‚úÖ V√≠deo tocando com √°udio!');
          })
          .catch(error => {
            console.log('‚ùå Erro ao tocar v√≠deo:', error);
          });
      }
    } else if (!isVideoPlaying) {
      // Se j√° desbloqueado mas pausado, retoma
      if (videoPausedTime > 0) {
        videoElement.currentTime = videoPausedTime;
      }
      
      videoElement.play()
        .then(() => {
          isVideoPlaying = true;
          console.log('‚ñ∂Ô∏è V√≠deo retomado!');
        })
        .catch(error => {
          console.error('‚ùå Erro ao retomar:', error);
        });
    }
  }

  // Fun√ß√£o para pausar o v√≠deo
  function pauseVideo() {
    if (isVideoPlaying) {
      videoPausedTime = videoElement.currentTime;
      videoElement.pause();
      isVideoPlaying = false;
      console.log('‚è∏Ô∏è V√≠deo pausado no tempo:', videoPausedTime);
    }
  }

  // ‚ñ∂ Quando reconhecer o target
  target.addEventListener("targetFound", () => {
    console.log('üéØ Target encontrado!');
    firstTargetFound = true;
    playVideo();
  });

  // ‚èπ Quando perder o target
  target.addEventListener("targetLost", () => {
    console.log('üö´ Target perdido!');
    pauseVideo();
  });

  // Quando o v√≠deo terminar
  videoElement.addEventListener('ended', function() {
    isVideoPlaying = false;
    videoPausedTime = 0;
    console.log('üèÅ V√≠deo terminou');
  });

  // Overlay invis√≠vel para desbloquear √°udio
  const unlockOverlay = document.createElement('div');
  unlockOverlay.style.position = 'fixed';
  unlockOverlay.style.top = '0';
  unlockOverlay.style.left = '0';
  unlockOverlay.style.width = '100%';
  unlockOverlay.style.height = '100%';
  unlockOverlay.style.zIndex = '10000';
  unlockOverlay.style.background = 'transparent';
  unlockOverlay.style.pointerEvents = 'auto';
  document.body.appendChild(unlockOverlay);

  // Fun√ß√£o para desbloquear √°udio
  function unlockAudio() {
    if (firstTargetFound && !videoUnlocked) {
      console.log('üîä Tentando desbloquear √°udio...');
      
      // Toca um som mudo primeiro para desbloquear (t√©cnica padr√£o)
      videoElement.muted = true;
      videoElement.play()
        .then(() => {
          videoElement.pause();
          videoElement.muted = false;
          videoElement.currentTime = videoPausedTime || 0;
          
          // Agora tenta tocar com √°udio
          return videoElement.play();
        })
        .then(() => {
          videoUnlocked = true;
          isVideoPlaying = true;
          console.log('üîä √Åudio desbloqueado com sucesso!');
          unlockOverlay.style.display = 'none';
        })
        .catch(e => {
          console.log('‚è≥ Ainda aguardando intera√ß√£o do usu√°rio...', e);
        });
    }
  }

  // Eventos de toque no overlay
  unlockOverlay.addEventListener('click', unlockAudio);
  unlockOverlay.addEventListener('touchstart', unlockAudio);

  // Monitorar o tempo do v√≠deo
  setInterval(() => {
    if (isVideoPlaying) {
      videoPausedTime = videoElement.currentTime;
    }
  }, 1000);

  // Pr√©-carrega o v√≠deo
  videoElement.load();

  console.log('üé¨ Script carregado, aponte para o target!');

});
</script>

</body>
</html>
