<!DOCTYPE html>
<html>
<head>
   <script>
const VERSION = "1.0.0"; 
// ‚Üë SEMPRE que atualizar modelo/v√≠deo ou target,
// s√≥ mude esse n√∫mero
</script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>

<!-- NECESS√ÅRIO PARA ANIMA√á√ÉO -->
<script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

<style>
body { margin:0; overflow:hidden; }

/* Bot√£o simplificado no canto inferior esquerdo */
.audio-control-btn {
  position: fixed;
  bottom: 20px;
  left: 20px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  z-index: 9999;
  cursor: pointer;
  border: 2px solid white;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  transition: all 0.3s ease;
  font-size: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: rgba(0, 0, 0, 0.7);
}

.audio-control-btn.playing {
  background-color: rgba(0, 128, 0, 0.8);
}

.audio-control-btn.paused {
  background-color: rgba(255, 0, 0, 0.8);
}

.audio-control-btn:hover {
  transform: scale(1.1);
}

/* Bot√£o de VR no canto inferior direito */
.a-enter-vr {
  position: fixed;
  bottom: 20px !important;
  right: 20px !important;
  left: auto !important;
  top: auto !important;
  transform: none !important;
}
</style>

</head>

<body>

<a-scene
  mindar-image="imageTargetSrc: Target01.mind;"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: false">

  <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

  <a-entity mindar-image-target="targetIndex: 0" id="target-principal">

    <!-- MODELO 3D (lado esquerdo) -->
    <a-entity
      id="mascote"
      gltf-model="Cena 01Teste.glb"
      animation-mixer
      position="-0.8 0 0.3"
      rotation="0 0 0"
      scale="0.7 0.7 0.7">
    </a-entity>

    <!-- V√çDEO (lado direito) -->
    <a-video
      id="video-mascote"
      src="Video Antecipe Portugues 1.mp4"
      position="0.8 0 0.3"
      rotation="0 0 0"
      width="1.2"
      height="0.8">
    </a-video>

  </a-entity>

  <!-- Elemento de v√≠deo HTML5 escondido (com √°udio incluso) -->
  <video id="meuVideo" preload="auto" loop="false" crossorigin="anonymous" style="display: none;">
    <source src="SeuVideo.mp4" type="video/mp4">
    <!-- Substitua "SeuVideo.mp4" pelo caminho correto do seu arquivo de v√≠deo -->
  </video>

  <script>
document.addEventListener("DOMContentLoaded", function () {

  const target = document.querySelector('#target-principal');
  
  // Refer√™ncia direta ao elemento de v√≠deo HTML5
  const videoElement = document.querySelector('#meuVideo');
  
  // Vari√°veis de controle
  let videoUnlocked = false;
  let videoPausedTime = 0;
  let isVideoPlaying = false;
  let firstTargetFound = false;
  
  // Criar bot√£o de controle simplificado
  const audioBtn = document.createElement('button');
  audioBtn.id = 'audioControlBtn';
  audioBtn.className = 'audio-control-btn paused';
  audioBtn.innerHTML = 'üîá'; // √çcone de mudo
  document.body.appendChild(audioBtn);

  // Fun√ß√£o para atualizar o √≠cone do bot√£o
  function updateButtonIcon() {
    if (isVideoPlaying) {
      audioBtn.innerHTML = 'üîä'; // √çcone de som alto
      audioBtn.classList.add('playing');
      audioBtn.classList.remove('paused');
    } else {
      audioBtn.innerHTML = 'üîá'; // √çcone de mudo
      audioBtn.classList.add('paused');
      audioBtn.classList.remove('playing');
    }
  }

  // Fun√ß√£o para tentar tocar v√≠deo
  function tryPlayVideo() {
    if (!videoUnlocked) {
      // Tenta desbloquear e tocar
      videoElement.play()
        .then(() => {
          videoUnlocked = true;
          isVideoPlaying = true;
          console.log('V√≠deo desbloqueado e tocando!');
          updateButtonIcon();
        })
        .catch(error => {
          console.log('N√£o foi poss√≠vel tocar v√≠deo automaticamente:', error);
          videoUnlocked = false;
        });
    } else if (!isVideoPlaying) {
      // Se j√° est√° desbloqueado mas pausado, toca de onde parou
      if (videoPausedTime > 0) {
        videoElement.currentTime = videoPausedTime;
      }
      
      videoElement.play()
        .then(() => {
          isVideoPlaying = true;
          console.log('V√≠deo tocando, tempo:', videoElement.currentTime);
          updateButtonIcon();
        })
        .catch(error => {
          console.error('Erro ao tocar v√≠deo:', error);
        });
    }
  }

  // Fun√ß√£o para pausar v√≠deo
  function pauseVideo() {
    if (isVideoPlaying) {
      videoPausedTime = videoElement.currentTime;
      videoElement.pause();
      isVideoPlaying = false;
      console.log('V√≠deo pausado no tempo:', videoPausedTime);
      updateButtonIcon();
    }
  }

  // ‚ñ∂ Quando reconhecer o target
  target.addEventListener("targetFound", () => {
    console.log('Target encontrado!');
    
    firstTargetFound = true;
    
    // Tenta tocar o v√≠deo automaticamente
    tryPlayVideo();
  });

  // ‚èπ Quando perder o target
  target.addEventListener("targetLost", () => {
    console.log('Target perdido!');
    pauseVideo();
  });

  // Bot√£o para controle manual (toggle)
  audioBtn.addEventListener('click', function() {
    if (isVideoPlaying) {
      pauseVideo();
    } else {
      tryPlayVideo();
    }
  });

  // Monitorar o tempo do v√≠deo
  setInterval(() => {
    if (isVideoPlaying) {
      videoPausedTime = videoElement.currentTime;
    }
  }, 1000);

  // Quando o v√≠deo terminar, resetar
  videoElement.addEventListener('ended', function() {
    isVideoPlaying = false;
    videoPausedTime = 0;
    updateButtonIcon();
    console.log('V√≠deo terminou');
  });

  // Tamb√©m tenta tocar quando qualquer intera√ß√£o ocorrer na tela
  document.body.addEventListener('click', function() {
    if (firstTargetFound && !videoUnlocked) {
      tryPlayVideo();
    }
  });
  
  document.body.addEventListener('touchstart', function() {
    if (firstTargetFound && !videoUnlocked) {
      tryPlayVideo();
    }
  });

  // Pr√©-carrega o v√≠deo
  videoElement.load();

});
</script>

</body>
</html>

