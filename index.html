<!DOCTYPE html>
<html>
<head>
   <script>
const VERSION = "1.0.0"; 
</script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

<style>
body { margin:0; overflow:hidden; }
.audio-control-btn {
  position: fixed;
  bottom: 20px;
  left: 20px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  z-index: 9999;
  cursor: pointer;
  border: 2px solid white;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  transition: all 0.3s ease;
  font-size: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: rgba(0, 0, 0, 0.7);
}
.audio-control-btn.playing { background-color: rgba(0, 128, 0, 0.8); }
.audio-control-btn.paused { background-color: rgba(255, 0, 0, 0.8); }
.audio-control-btn:hover { transform: scale(1.1); }
.a-enter-vr {
  position: fixed;
  bottom: 20px !important;
  right: 20px !important;
  left: auto !important;
  top: auto !important;
  transform: none !important;
}
</style>
</head>

<body>

<a-scene
  mindar-image="imageTargetSrc: Target01.mind;"  <!-- USANDO Target01.mind -->
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: false">

  <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

  <!-- ========================================= -->
  <!-- TARGET 0 - Modelo 3D (primeira imagem)    -->
  <!-- ========================================= -->
  <a-entity mindar-image-target="targetIndex: 0" id="target-modelo">

    <!-- MODELO 3D -->
    <a-entity
      id="mascote"
      gltf-model="MascoteDanca.glb"
      animation-mixer
      position="0 0 0.3"
      rotation="-90 0 0"
      scale="0.7 0.7 0.7">
    </a-entity>

  </a-entity>

  <!-- ========================================= -->
  <!-- TARGET 1 - Vﾃ好EO (segunda imagem)         -->
  <!-- ========================================= -->
  <a-entity mindar-image-target="targetIndex: 1" id="target-video">

    <!-- TELA DE Vﾃ好EO -->
    <a-entity
      id="tela-video"
      geometry="primitive: plane; width: 1; height: 0.56"
      material="shader: flat; src: #meuVideo; transparent: true;"
      position="0 0 0.3"
      rotation="-90 0 0"
      scale="0.7 0.7 0.7">
    </a-entity>

    <!-- Vﾃ好EO (escondido) -->
    <video id="meuVideo" preload="auto" loop style="display: none;" crossorigin="anonymous">
      <source src="Video Antecipe Portugues 1.mp4" type="video/mp4">
    </video>

  </a-entity>

  <!-- ﾃゞDIO do modelo -->
  <audio id="audioMascote" preload="auto" style="display: none;" loop="false">
    <source src="AudioTrack11.mp3" type="audio/mpeg">
  </audio>

  <script>
document.addEventListener("DOMContentLoaded", function () {

  // Elementos
  const targetModelo = document.querySelector('#target-modelo');
  const targetVideo = document.querySelector('#target-video');
  const audioElement = document.querySelector('#audioMascote');
  const videoElement = document.querySelector('#meuVideo');
  
  // Variﾃ｡veis
  let audioUnlocked = false;
  let audioPausedTime = 0;
  let isAudioPlaying = false;
  let videoPausedTime = 0;
  let isVideoPlaying = false;
  let currentTarget = null;
  
  // Botﾃ｣o
  const audioBtn = document.createElement('button');
  audioBtn.id = 'audioControlBtn';
  audioBtn.className = 'audio-control-btn paused';
  audioBtn.innerHTML = '沐';
  document.body.appendChild(audioBtn);

  function updateButtonIcon() {
    if (isAudioPlaying || isVideoPlaying) {
      audioBtn.innerHTML = '沐';
      audioBtn.classList.add('playing');
      audioBtn.classList.remove('paused');
    } else {
      audioBtn.innerHTML = '沐';
      audioBtn.classList.add('paused');
      audioBtn.classList.remove('playing');
    }
  }

  // ============================================
  // TARGET 0 - MODELO
  // ============================================
  targetModelo.addEventListener("targetFound", () => {
    console.log('TARGET 0 encontrado! (Modelo)');
    currentTarget = 'modelo';
    
    // Pausa vﾃｭdeo se estiver tocando
    if (isVideoPlaying) {
      videoPausedTime = videoElement.currentTime;
      videoElement.pause();
      isVideoPlaying = false;
    }
    
    // Toca ﾃ｡udio do modelo
    if (!audioUnlocked) {
      audioElement.play()
        .then(() => {
          audioUnlocked = true;
          isAudioPlaying = true;
          updateButtonIcon();
        })
        .catch(() => {});
    } else {
      if (audioPausedTime > 0) audioElement.currentTime = audioPausedTime;
      audioElement.play().then(() => {
        isAudioPlaying = true;
        updateButtonIcon();
      });
    }
  });

  targetModelo.addEventListener("targetLost", () => {
    console.log('TARGET 0 perdido!');
    if (isAudioPlaying) {
      audioPausedTime = audioElement.currentTime;
      audioElement.pause();
      isAudioPlaying = false;
      updateButtonIcon();
    }
  });

  // ============================================
  // TARGET 1 - Vﾃ好EO
  // ============================================
  targetVideo.addEventListener("targetFound", () => {
    console.log('TARGET 1 encontrado! (Vﾃｭdeo)');
    currentTarget = 'video';
    
    // Pausa ﾃ｡udio se estiver tocando
    if (isAudioPlaying) {
      audioPausedTime = audioElement.currentTime;
      audioElement.pause();
      isAudioPlaying = false;
    }
    
    // Toca vﾃｭdeo
    if (!videoUnlocked) {
      videoElement.play()
        .then(() => {
          videoUnlocked = true;
          isVideoPlaying = true;
          updateButtonIcon();
        })
        .catch(() => {});
    } else {
      if (videoPausedTime > 0) videoElement.currentTime = videoPausedTime;
      videoElement.play().then(() => {
        isVideoPlaying = true;
        updateButtonIcon();
      });
    }
  });

  targetVideo.addEventListener("targetLost", () => {
    console.log('TARGET 1 perdido!');
    if (isVideoPlaying) {
      videoPausedTime = videoElement.currentTime;
      videoElement.pause();
      isVideoPlaying = false;
      updateButtonIcon();
    }
  });

  // Botﾃ｣o manual
  audioBtn.addEventListener('click', function() {
    if (isAudioPlaying) {
      audioPausedTime = audioElement.currentTime;
      audioElement.pause();
      isAudioPlaying = false;
    } else if (isVideoPlaying) {
      videoPausedTime = videoElement.currentTime;
      videoElement.pause();
      isVideoPlaying = false;
    } else {
      if (currentTarget === 'modelo') {
        if (audioPausedTime > 0) audioElement.currentTime = audioPausedTime;
        audioElement.play().then(() => isAudioPlaying = true);
      } else if (currentTarget === 'video') {
        if (videoPausedTime > 0) videoElement.currentTime = videoPausedTime;
        videoElement.play().then(() => isVideoPlaying = true);
      }
    }
    updateButtonIcon();
  });

  // Monitorar tempos
  setInterval(() => {
    if (isAudioPlaying) audioPausedTime = audioElement.currentTime;
    if (isVideoPlaying) videoPausedTime = videoElement.currentTime;
  }, 1000);

  // Desbloqueio
  document.body.addEventListener('click', function unlock() {
    audioElement.play().then(() => { audioElement.pause(); audioElement.currentTime = 0; }).catch(() => {});
    videoElement.play().then(() => { videoElement.pause(); videoElement.currentTime = 0; }).catch(() => {});
    document.body.removeEventListener('click', unlock);
  });

  audioElement.load();
  videoElement.load();

  console.log('笨 Sistema pronto!');
  console.log('沁ｯ Target 0: Modelo 3D');
  console.log('沁ｯ Target 1: Vﾃｭdeo');

});
</script>

</body>
</html>
