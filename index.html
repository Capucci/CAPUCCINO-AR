<!DOCTYPE html>
<html>
<head>
   <script>
const VERSION = "6.0.0"; // VersÃ£o com 6 targets (cubo completo)
</script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

<style>
body { margin:0; overflow:hidden; }

/* BotÃ£o de Ã¡udio no canto inferior esquerdo */
.audio-control-btn {
  position: fixed;
  bottom: 20px;
  left: 20px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  z-index: 9999;
  cursor: pointer;
  border: 2px solid white;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  transition: all 0.3s ease;
  font-size: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: rgba(0, 0, 0, 0.7);
}

.audio-control-btn.playing {
  background-color: rgba(0, 128, 0, 0.8);
}

.audio-control-btn.paused {
  background-color: rgba(255, 0, 0, 0.8);
}

.audio-control-btn:hover {
  transform: scale(1.1);
}

/* BotÃ£o de VR no canto inferior direito */
.a-enter-vr {
  position: fixed;
  bottom: 20px !important;
  right: 20px !important;
  left: auto !important;
  top: auto !important;
  transform: none !important;
}

/* InstruÃ§Ãµes */
.instructions {
  position: fixed;
  top: 20px;
  left: 20px;
  color: white;
  background: rgba(0,0,0,0.5);
  padding: 8px 15px;
  border-radius: 20px;
  font-size: 14px;
  z-index: 9999;
}

/* Indicador de face (opcional) */
.face-indicator {
  position: fixed;
  top: 20px;
  right: 20px;
  color: white;
  background: rgba(0,0,0,0.7);
  padding: 10px 20px;
  border-radius: 30px;
  font-size: 16px;
  z-index: 9999;
  border: 2px solid #00ff88;
}
</style>
</head>

<body>
  <!-- InstruÃ§Ãµes -->
  <div class="instructions">
    ðŸŽ² Cubo de 6 faces | Aponte para cada lado
  </div>

  <!-- Indicador de face ativa -->
  <div class="face-indicator" id="faceIndicator">
    ðŸ”´ Nenhuma face detectada
  </div>

  <a-scene
    mindar-image="imageTargetSrc: cubo-6-faces.mind;" <!-- Arquivo com 6 targets -->
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false">

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <!-- ========================================= -->
    <!-- FACE 1 - MASCOTE PRINCIPAL                -->
    <!-- ========================================= -->
    <a-entity mindar-image-target="targetIndex: 0" id="face-1">
      <a-entity
        id="mascote"
        gltf-model="Cena01Teste.glb"
        animation-mixer="clip: fala; loop: repeat;"
        position="0 0 0.3"
        rotation="-90 0 0"
        scale="0.7 0.7 0.7">
      </a-entity>
      <a-entity id="Moo.mp3" 
                sound="src: mascote-fala.mp3; positional: false; autoplay: false; loop: false;">
      </a-entity>
    </a-entity>

    <!-- ========================================= -->
    <!-- FACE 2 - VÃDEO PROMOCIONAL                 -->
    <!-- ========================================= -->
    <a-entity mindar-image-target="targetIndex: 1" id="face-2">
      <a-entity
        id="Video Antecipe Portugues 1.mp4"
        geometry="primitive: plane; width: 1; height: 0.56"
        material="shader: flat; src: #video1; transparent: true;"
        position="0 0 0.3"
        rotation="-90 0 0"
        scale="0.7 0.7 0.7">
      </a-entity>
      <video id="video1" src="video-promo.mp4" preload="auto" style="display: none;" crossorigin="anonymous" loop></video>
    </a-entity>

    <!-- ========================================= -->
    <!-- FACE 3 - MASCOTE DANÃ‡ANDO                  -->
    <!-- ========================================= -->
    <a-entity mindar-image-target="targetIndex: 2" id="face-3">
      <a-entity
        id="mascote-danca"
        gltf-model="MascoteDanca.glb"
        animation-mixer="clip: danca; loop: repeat;"
        position="0 0 0.3"
        rotation="-90 0 0"
        scale="0.7 0.7 0.7">
      </a-entity>
      <a-entity id="Chuva02.mp3" 
                sound="src: musica-danca.mp3; positional: false; autoplay: false; loop: false;">
      </a-entity>
    </a-entity>

    <!-- ========================================= -->
    <!-- FACE 4 - VÃDEO TUTORIAL                    -->
    <!-- ========================================= -->
    <a-entity mindar-image-target="targetIndex: 3" id="face-4">
      <a-entity
        id="video2-screen"
        geometry="primitive: plane; width: 1; height: 0.56"
        material="shader: flat; src: #video2; transparent: true;"
        position="0 0 0.3"
        rotation="-90 0 0"
        scale="0.7 0.7 0.7">
      </a-entity>
      <video id="video2" src="video-tutorial.mp4" preload="auto" style="display: none;" crossorigin="anonymous" loop></video>
    </a-entity>

    <!-- ========================================= -->
    <!-- FACE 5 - CENA INTERATIVA (BotÃµes)         -->
    <!-- ========================================= -->
    <a-entity mindar-image-target="targetIndex: 4" id="face-5">
      <!-- Modelo base -->
      <a-entity
        id="cena-interativa"
        gltf-model="cena-base.glb"
        animation-mixer="clip: idle; loop: repeat;"
        position="0 0 0.3"
        rotation="-90 0 0"
        scale="0.7 0.7 0.7">
      </a-entity>
      
      <!-- Ãudio ambiente -->
      <a-entity id="audio-ambiente" 
                sound="src: ambiente.mp3; positional: false; autoplay: false; loop: true;">
      </a-entity>
    </a-entity>

    <!-- ========================================= -->
    <!-- FACE 6 - LOGO / CRÃ‰DITOS                   -->
    <!-- ========================================= -->
    <a-entity mindar-image-target="targetIndex: 5" id="face-6">
      <!-- Logo 3D -->
      <a-entity
        id="logo"
        gltf-model="logo.glb"
        animation-mixer="clip: girar; loop: repeat;"
        position="0 0 0.3"
        rotation="-90 0 0"
        scale="0.5 0.5 0.5">
      </a-entity>
      
      <!-- MÃºsica de fundo -->
      <a-entity id="audio-logo" 
                sound="src: musica-fundo.mp3; positional: false; autoplay: false; loop: true;">
      </a-entity>
    </a-entity>

  </a-scene>

  <!-- BotÃ£o de controle de Ã¡udio -->
  <button class="audio-control-btn paused" id="audioBtn">ðŸ”‡</button>

  <script>
document.addEventListener("DOMContentLoaded", function () {
  // ============================================
  // CONFIGURAÃ‡ÃƒO DAS 6 FACES DO CUBO
  // ============================================
  const faces = [
    {
      id: 'face-1',
      type: 'model',
      name: 'Face 1 - Mascote Falante',
      audioId: 'audio-mascote',
      modelId: 'mascote',
      videoId: null,
      currentTime: 0,
      isPlaying: false,
      icon: 'ðŸ§¸'
    },
    {
      id: 'face-2',
      type: 'video',
      name: 'Face 2 - VÃ­deo Promo',
      videoId: 'video1',
      audioId: null,
      modelId: null,
      currentTime: 0,
      isPlaying: false,
      icon: 'ðŸŽ¬'
    },
    {
      id: 'face-3',
      type: 'model',
      name: 'Face 3 - Mascote DanÃ§a',
      audioId: 'audio-danca',
      modelId: 'mascote-danca',
      videoId: null,
      currentTime: 0,
      isPlaying: false,
      icon: 'ðŸ’ƒ'
    },
    {
      id: 'face-4',
      type: 'video',
      name: 'Face 4 - Tutorial',
      videoId: 'video2',
      audioId: null,
      modelId: null,
      currentTime: 0,
      isPlaying: false,
      icon: 'ðŸ“¹'
    },
    {
      id: 'face-5',
      type: 'model',
      name: 'Face 5 - Interativa',
      audioId: 'audio-ambiente',
      modelId: 'cena-interativa',
      videoId: null,
      currentTime: 0,
      isPlaying: false,
      icon: 'ðŸŽ®'
    },
    {
      id: 'face-6',
      type: 'model',
      name: 'Face 6 - Logo',
      audioId: 'audio-logo',
      modelId: 'logo',
      videoId: null,
      currentTime: 0,
      isPlaying: false,
      icon: 'â­'
    }
  ];

  // Elementos da interface
  const audioBtn = document.getElementById('audioBtn');
  const faceIndicator = document.getElementById('faceIndicator');
  let globalPlaying = false;
  let currentFaceIndex = -1;

  // ============================================
  // FUNÃ‡Ã•ES DE CONTROLE
  // ============================================
  
  function pauseFace(faceIndex) {
    const face = faces[faceIndex];
    if (!face || !face.isPlaying) return;
    
    console.log(`â¸ï¸ Pausando ${face.name}`);
    
    if (face.type === 'model') {
      // Pausar Ã¡udio
      if (face.audioId) {
        const audio = document.querySelector('#' + face.audioId);
        if (audio && audio.components.sound) {
          face.currentTime = audio.components.sound.currentTime || 0;
          audio.components.sound.stopSound();
        }
      }
      
      // Pausar animaÃ§Ã£o
      if (face.modelId) {
        const model = document.querySelector('#' + face.modelId);
        if (model) {
          model.setAttribute('animation-mixer', 'timeScale', 0);
        }
      }
    }
    else if (face.type === 'video') {
      // Pausar vÃ­deo
      const video = document.querySelector('#' + face.videoId);
      if (video) {
        face.currentTime = video.currentTime;
        video.pause();
      }
    }
    
    face.isPlaying = false;
    checkGlobalState();
  }

  function resumeFace(faceIndex) {
    const face = faces[faceIndex];
    if (!face) return;
    
    // Se jÃ¡ tem uma face tocando, pausa ela primeiro
    if (currentFaceIndex >= 0 && currentFaceIndex !== faceIndex) {
      pauseFace(currentFaceIndex);
    }
    
    console.log(`â–¶ï¸ Continuando ${face.name}`);
    
    if (face.type === 'model') {
      // Continuar Ã¡udio
      if (face.audioId) {
        const audio = document.querySelector('#' + face.audioId);
        if (audio && audio.components.sound) {
          audio.components.sound.currentTime = face.currentTime;
          audio.components.sound.playSound();
        }
      }
      
      // Continuar animaÃ§Ã£o
      if (face.modelId) {
        const model = document.querySelector('#' + face.modelId);
        if (model) {
          model.setAttribute('animation-mixer', 'timeScale', 1);
        }
      }
    }
    else if (face.type === 'video') {
      // Continuar vÃ­deo
      const video = document.querySelector('#' + face.videoId);
      if (video) {
        video.currentTime = face.currentTime;
        video.play().catch(e => console.log('Aguardando interaÃ§Ã£o:', e));
      }
    }
    
    face.isPlaying = true;
    currentFaceIndex = faceIndex;
    updateFaceIndicator(faceIndex);
    checkGlobalState();
  }

  // ============================================
  // ATUALIZAR INDICADOR DE FACE
  // ============================================
  function updateFaceIndicator(faceIndex) {
    const face = faces[faceIndex];
    if (face) {
      faceIndicator.innerHTML = `ðŸŽ² ${face.icon} ${face.name}`;
      faceIndicator.style.borderColor = '#00ff88';
    } else {
      faceIndicator.innerHTML = 'ðŸ”´ Nenhuma face detectada';
      faceIndicator.style.borderColor = '#ff4444';
    }
  }

  // ============================================
  // VERIFICAR ESTADO GLOBAL
  // ============================================
  function checkGlobalState() {
    globalPlaying = faces.some(f => f.isPlaying);
    
    if (globalPlaying) {
      audioBtn.innerHTML = 'ðŸ”Š';
      audioBtn.classList.add('playing');
      audioBtn.classList.remove('paused');
    } else {
      audioBtn.innerHTML = 'ðŸ”‡';
      audioBtn.classList.add('paused');
      audioBtn.classList.remove('playing');
    }
  }

  // ============================================
  // DESBLOQUEAR MÃDIAS
  // ============================================
  let mediaUnlocked = false;
  
  function unlockAllMedia() {
    if (mediaUnlocked) return;
    
    console.log('ðŸ”“ Desbloqueando mÃ­dias...');
    
    faces.forEach(face => {
      if (face.type === 'model' && face.audioId) {
        const audio = document.querySelector('#' + face.audioId);
        if (audio && audio.components.sound) {
          audio.components.sound.playSound();
          audio.components.sound.stopSound();
        }
      }
      else if (face.type === 'video' && face.videoId) {
        const video = document.querySelector('#' + face.videoId);
        if (video) {
          video.play().then(() => video.pause()).catch(() => {});
        }
      }
    });
    
    mediaUnlocked = true;
    console.log('âœ… MÃ­dias desbloqueadas!');
  }

  // ============================================
  // DETECTAR FACES DO CUBO
  // ============================================
  faces.forEach((face, index) => {
    const faceEl = document.getElementById(face.id);
    
    if (faceEl) {
      faceEl.addEventListener("targetFound", () => {
        console.log(`ðŸŽ¯ FACE ENCONTRADA: ${face.name}`);
        resumeFace(index);
      });

      faceEl.addEventListener("targetLost", () => {
        console.log(`ðŸš« FACE PERDIDA: ${face.name}`);
        pauseFace(index);
        if (currentFaceIndex === index) {
          currentFaceIndex = -1;
          updateFaceIndicator(-1);
        }
      });
    }
  });

  // ============================================
  // BOTÃƒO MANUAL
  // ============================================
  audioBtn.addEventListener('click', function() {
    unlockAllMedia();
    
    if (currentFaceIndex >= 0) {
      // Se tem face ativa, pausa
      pauseFace(currentFaceIndex);
    } else {
      // Se nÃ£o tem face ativa, tenta a Ãºltima
      const lastFace = faces.findIndex(f => f.currentTime > 0);
      if (lastFace >= 0) {
        resumeFace(lastFace);
      }
    }
  });

  // ============================================
  // DESBLOQUEAR NO PRIMEIRO CLIQUE
  // ============================================
  document.body.addEventListener('click', unlockAllMedia, { once: true });
  document.body.addEventListener('touchstart', unlockAllMedia, { once: true });

  // ============================================
  // MONITORAR TEMPOS
  // ============================================
  setInterval(() => {
    faces.forEach(face => {
      if (face.isPlaying) {
        if (face.type === 'model' && face.audioId) {
          const audio = document.querySelector('#' + face.audioId);
          if (audio && audio.components.sound) {
            face.currentTime = audio.components.sound.currentTime || 0;
          }
        }
        else if (face.type === 'video' && face.videoId) {
          const video = document.querySelector('#' + face.videoId);
          if (video) {
            face.currentTime = video.currentTime;
          }
        }
      }
    });
  }, 500);

  console.log('ðŸš€ Cubo de 6 faces iniciado!');
  console.log('ðŸ“‹ Faces configuradas:', faces.length);
});
</script>

<!-- VÃ­deos ocultos -->
<div style="display: none;">
  <video id="video1" preload="auto" crossorigin="anonymous"></video>
  <video id="video2" preload="auto" crossorigin="anonymous"></video>
</div>

</body>
</html>

